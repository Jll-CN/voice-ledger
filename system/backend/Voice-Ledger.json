{
  "name": "Voice-Ledger",
  "nodes": [
    {
      "parameters": {
        "options": {
          "systemMessage": "You are a Chinese expense extractor.\nReturn JSON only:\n{\n  \"date\": \"yyyy-mm-dd\",\n  \"amount\": <çº¯æ•°å­—>,\n  \"category\": \"<food|transport|...>\",\n  \"desc\": \"<äº‹ä»¶æè¿°>\",\n  \"raw\": \"<ç”¨æˆ·åŸæ–‡>\"\n}\n\næ—¥æœŸè®¡ç®—è§„åˆ™ï¼ˆå¿…è¯»ï¼‰\nç»Ÿä¸€åŸºå‡†\nå½“å‰çœŸå®æ—¥æœŸç”±è°ƒç”¨ get_date è·å¾—ï¼Œæ ¼å¼å›ºå®šä¸º yyyy-mm-ddã€‚\nè¯¥æ—¥æœŸå³ä¸ºâ€œä»Šå¤©â€ã€‚\nç›¸å¯¹æ—¥æœŸæ˜ å°„è¡¨\nâ€¢ â€œä»Šå¤©â€ â†’ åŸºå‡†æ—¥\nâ€¢ â€œæ˜¨å¤©â€ â†’ åŸºå‡†æ—¥ âˆ’ 1 å¤©\nâ€¢ â€œå‰å¤©â€ â†’ åŸºå‡†æ—¥ âˆ’ 2 å¤©\nâ€¢ â€œæ˜å¤©â€ â†’ åŸºå‡†æ—¥ + 1 å¤©ï¼ˆå¦‚å‡ºç°ï¼‰\nè®¡ç®—æ­¥éª¤\n(1) è°ƒç”¨ get_date å¾—åˆ° todayã€‚\n(2) æ ¹æ®ä¸Šè¡¨è®¡ç®—ç›®æ ‡æ—¥æœŸï¼Œæ ¼å¼åŒ–ä¸º yyyy-mm-ddã€‚\n(3) å°†ç»“æœå†™å…¥è¿”å› JSON çš„ \"date\" å­—æ®µã€‚\nè¾¹ç•Œå¤„ç†\nâ€¢ è‹¥å‡ºç°æœªåˆ—å‡ºçš„ç›¸å¯¹è¯ï¼ˆå¦‚â€œä¸Šå‘¨ä¸‰â€ï¼‰ï¼Œå¼ºåˆ¶ä½¿ç”¨ get_date è¿”å›å€¼ã€‚\nâ€¢ è‹¥å‡ºç°ç»å¯¹æ—¥æœŸï¼ˆå¦‚â€œ2025-01-30â€ï¼‰ï¼Œç›´æ¥åŸæ ·ä½¿ç”¨ï¼Œä¸å†è®¡ç®—ã€‚\n\nç¤ºä¾‹1ï¼ˆæœ‰ç›¸å¯¹æ—¥æœŸï¼‰ï¼š\nè¾“å…¥ï¼š\"2025-06-21ï¼Œæˆ‘åƒæ—©é¤èŠ±äº†10.5å…ƒ\"ã€‚\nè¾“å‡ºï¼š\n{\n  \"date\": \"2025-06-21\",\n  \"amount\": 10.5,\n  \"category\": \"food\",\n  \"desc\": \"ä¹°è±†æµ†\",\n  \"raw\": \"ä»Šå¤©æ—©ä¸Šä¹°è±†æµ†èŠ±äº† 10.5 å…ƒ\"\n}\nç¤ºä¾‹2ï¼ˆæ— æ—¥æœŸï¼‰ï¼š\n{\n  \"date\": \"2025-06-21\",\n  \"amount\": 25,\n  \"category\": \"food\",\n  \"desc\": \"åƒæ‹‰é¢\",\n  \"raw\": \"ä¸­åˆåƒæ‹‰é¢ï¼Œ25\"\n}\n",
          "maxIterations": 3
        }
      },
      "id": "b5d8f25a-ce78-4ba8-b35e-484a3ae42978",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        -1744,
        -1728
      ],
      "typeVersion": 1.7
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "Hi there! ğŸ‘‹\nMy name is Voice ledger. How can I assist you today?",
        "options": {}
      },
      "id": "7789a182-cb9d-4d58-ba07-e33e66547efb",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        -2352,
        -1808
      ],
      "webhookId": "6a34ec84-459d-4cc4-83b6-06ae4c99dc8f",
      "typeVersion": 1.1
    },
    {
      "parameters": {},
      "id": "cde1323c-2ed6-4e44-8f79-238b7be65e06",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        -1680,
        -1456
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        -1856,
        -1456
      ],
      "id": "4c277010-f33c-44ff-a606-ef7ac5105397",
      "name": "DeepSeek Chat Model",
      "credentials": {
        "deepSeekApi": {
          "id": "XEI0ZkviLfb51RP7",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "text": "=convert expense to JSON:  \n\n{{ $json.output }}",
        "attributes": {
          "attributes": [
            {
              "name": "amount",
              "type": "number",
              "description": "expense cost",
              "required": true
            },
            {
              "name": "des",
              "description": "description of expense",
              "required": true
            },
            {
              "name": "date",
              "type": "date",
              "description": "date in UTC format. "
            },
            {
              "name": "category",
              "description": "the category of this cost"
            },
            {
              "name": "raw_input",
              "description": "raw data of this input"
            }
          ]
        },
        "options": {}
      },
      "id": "dc16a9cb-a8f3-4081-bc32-8a80e2daf88a",
      "name": "Expense text to JSON parser",
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "position": [
        -1328,
        -1728
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1txXpSRhG4iFZszd9Feo3bscD7ayRZqKxOOkjUYk9AZE/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1txXpSRhG4iFZszd9Feo3bscD7ayRZqKxOOkjUYk9AZE/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "date": "={{ $json.output.date }}",
            "amount": "={{ $json.output.amount }}",
            "category": "={{ $json.output.category }}",
            "des": "={{ $json.output.des }}",
            "raw_input": "={{ $json.output.raw_input }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "amount",
              "displayName": "amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "category",
              "displayName": "category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "des",
              "displayName": "des",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "raw_input",
              "displayName": "raw_input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "eb0fb714-167f-4953-89ec-0e59a35e4cd0",
      "name": "Save expense into Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        -928,
        -1728
      ],
      "notesInFlow": true,
      "typeVersion": 4.5,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "PGzewNOpLKQRuMH7",
          "name": "Google Sheets account"
        }
      },
      "notes": "Do not forget to Clone the Google Sheet and re-link this node to your sheet!"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        -1232,
        -1536
      ],
      "id": "7a0b37d5-291b-4ffe-ba2a-863b81e08b8a",
      "name": "DeepSeek Chat Model1",
      "credentials": {
        "deepSeekApi": {
          "id": "XEI0ZkviLfb51RP7",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "includeTime": false,
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        -1504,
        -1456
      ],
      "id": "2ed74c25-b42a-41a3-86a9-b9fa914ce5e7",
      "name": "Date & Time",
      "notes": "è·å–å½“å‰dateçš„å·¥å…·"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "e3ff14eb-db4a-44b2-a574-6d60f564ec4e",
        "options": {
          "responseData": "{\n  \"code\": 0,\n  \"msg\": \"å¤„ç†æˆåŠŸ\",\n  \"data\": null\n}"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2352,
        -1632
      ],
      "id": "1c2ca367-8e25-4c69-a942-81d1774e7b35",
      "name": "Webhook",
      "webhookId": "e3ff14eb-db4a-44b2-a574-6d60f564ec4e"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\n// æ„é€ æ–°çš„è¾“å‡ºé¡¹\nconst outputItem = {\n    json: {\n        sessionId: '',\n        action: '',\n        chatInput: ''\n    }\n};\n\nfor (const item of $input.all()) {\n  console.log(\"æ¥æ”¶çš„Bodyæ•°æ®æ˜¯: \" + JSON.stringify(item.json.body))\n\n  outputItem.json.sessionId = item.json.body.session_id;\n  outputItem.json.action = item.json.body.action;\n  outputItem.json.chatInput = item.json.body.text;\n}\n\nconsole.log(\"Outputæ•°æ®æ˜¯: \" + JSON.stringify(outputItem))\nreturn outputItem;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2112,
        -1680
      ],
      "id": "48f9d083-97a9-4c3e-85a9-c04bf46311cf",
      "name": "Code"
    },
    {
      "parameters": {
        "content": "## Project Description \nSay a sentence, enter text, click a button, and automatically write the expenditure record into Google Sheets in a lazy way.\n\n### System Input\n\n| Input | Example |\n| :-----: | :----- |\n| From chat box |  eg. I had lunch for noodles. It cost 18RMB|\n| From  frontend |   I had beef noodle soup for lunch today and it cost 20 RMB. |\n\n### Qucikly use\n1. Use the front-end voice input buttons or use the platform-provided chatbox\n2. Just say the expenses. Eg. I spent 20 yuan on a taxi yesterday, or I ate 5 yuan for breakfast today.\n3. System feedback, successful operation information.\n4. Open Google Sheets to see new records\n\n### Architecture Description\nInput ---> HTTP Node ---> AI Agent ----> DeepSeek Analysis ---> Save to Google Sheets.\n| Node               | Function                                                  | Key Configuration          |\n| :----------------- | :-------------------------------------------------------- | :------------------------- |\n| HTTP In (Webhook)  | Unified entry point that receives JSON:<br>`{\"text\":\"60 yuan for taxi ride\",\"user\":\"zhang\"}` | Method: POST               |\n| AI Agent           | Converts raw text to structured JSON according to Prompt  | See \"Prompt Template\" below |\n| DeepSeek (LLM)     | Secondary verification and completion of missing fields (e.g., date, currency) | temperature=0.1 for stability |\n| Google Sheets      | Writes fields to specified worksheet                       | Authorization + Sheet ID only |\n\n### Agent Prompt\n```You are a Chinese expense extractor.\nReturn JSON only:\n{\n  \"date\": \"yyyy-mm-dd\",\n  \"amount\": <çº¯æ•°å­—>,\n  \"category\": \"<food|transport|...>\",\n  \"desc\": \"<äº‹ä»¶æè¿°>\",\n  \"raw\": \"<ç”¨æˆ·åŸæ–‡>\"\n}\n\næ—¥æœŸè®¡ç®—è§„åˆ™ï¼ˆå¿…è¯»ï¼‰\nç»Ÿä¸€åŸºå‡†\nå½“å‰çœŸå®æ—¥æœŸç”±è°ƒç”¨ get_date è·å¾—ï¼Œæ ¼å¼å›ºå®šä¸º yyyy-mm-ddã€‚\nè¯¥æ—¥æœŸå³ä¸ºâ€œä»Šå¤©â€ã€‚\nç›¸å¯¹æ—¥æœŸæ˜ å°„è¡¨\nâ€¢ â€œä»Šå¤©â€ â†’ åŸºå‡†æ—¥\nâ€¢ â€œæ˜¨å¤©â€ â†’ åŸºå‡†æ—¥ âˆ’ 1 å¤©\nâ€¢ â€œå‰å¤©â€ â†’ åŸºå‡†æ—¥ âˆ’ 2 å¤©\nâ€¢ â€œæ˜å¤©â€ â†’ åŸºå‡†æ—¥ + 1 å¤©ï¼ˆå¦‚å‡ºç°ï¼‰\nè®¡ç®—æ­¥éª¤\n(1) è°ƒç”¨ get_date å¾—åˆ° todayã€‚\n(2) æ ¹æ®ä¸Šè¡¨è®¡ç®—ç›®æ ‡æ—¥æœŸï¼Œæ ¼å¼åŒ–ä¸º yyyy-mm-ddã€‚\n(3) å°†ç»“æœå†™å…¥è¿”å› JSON çš„ \"date\" å­—æ®µã€‚\nè¾¹ç•Œå¤„ç†\nâ€¢ è‹¥å‡ºç°æœªåˆ—å‡ºçš„ç›¸å¯¹è¯ï¼ˆå¦‚â€œä¸Šå‘¨ä¸‰â€ï¼‰ï¼Œå¼ºåˆ¶ä½¿ç”¨ get_date è¿”å›å€¼ã€‚\nâ€¢ è‹¥å‡ºç°ç»å¯¹æ—¥æœŸï¼ˆå¦‚â€œ2025-01-30â€ï¼‰ï¼Œç›´æ¥åŸæ ·ä½¿ç”¨ï¼Œä¸å†è®¡ç®—ã€‚\n\nç¤ºä¾‹1ï¼ˆæœ‰ç›¸å¯¹æ—¥æœŸï¼‰ï¼š\nè¾“å…¥ï¼š\"2025-06-21ï¼Œæˆ‘åƒæ—©é¤èŠ±äº†10.5å…ƒ\"ã€‚\nè¾“å‡ºï¼š\n{\n  \"date\": \"2025-06-21\",\n  \"amount\": 10.5,\n  \"category\": \"food\",\n  \"desc\": \"ä¹°è±†æµ†\",\n  \"raw\": \"ä»Šå¤©æ—©ä¸Šä¹°è±†æµ†èŠ±äº† 10.5 å…ƒ\"\n}\nç¤ºä¾‹2ï¼ˆæ— æ—¥æœŸï¼‰ï¼š\n{\n  \"date\": \"2025-06-21\",\n  \"amount\": 25,\n  \"category\": \"food\",\n  \"desc\": \"åƒæ‹‰é¢\",\n  \"raw\": \"ä¸­åˆåƒæ‹‰é¢ï¼Œ25\"\n}\n```\n\n### Setup\n1. Open n8n â†’ Workflows â†’ Import â†’ Select workflow.json\n2. Fill in credentials:\n   - DeepSeek API Key\n   - Google Sheets OAuth JSON\n3. The frontend application needs to be updated to use the backend request path.\n\n### Google Sheets\n| date       | amount | category  | description | raw_input                  |\n| :--------- | :----- | :-------- | :---------- | :------------------------- |\n| 2025-06-01 | 10     | transport | æ‰“è½¦        | ä»Šå¤©æ‰“è½¦èŠ±åå—é’±ã€‚         |\n| 2025-05-31 | 15     | food      | åƒç‰›è‚‰é¢    | æ˜¨å¤©åƒç‰›è‚‰é¢èŠ±äº†15å—é’±ã€‚   |\n| 2025-05-31 | 10     | food      | æ—©é¥­        | æ˜¨å¤©æ—©é¥­èŠ±äº†åå—ã€‚         |",
        "height": 1680,
        "width": 768
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3184,
        -2144
      ],
      "typeVersion": 1,
      "id": "d42e159e-ce00-4e38-b022-7ccfbb344b5e",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Expense text to JSON parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Expense text to JSON parser": {
      "main": [
        [
          {
            "node": "Save expense into Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Expense text to JSON parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "07e2383a-4949-407d-82c8-2bc70f0f1138",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6ac7a47db145f775750bb531bd4652c85d3be5a096edd897701266b6a280600b"
  },
  "id": "FF4TBc9CSB2mjaH1",
  "tags": []
}